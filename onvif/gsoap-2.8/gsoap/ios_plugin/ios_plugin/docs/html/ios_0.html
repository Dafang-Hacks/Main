<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>gSOAP iOS: The iOS plugin for developing client applications on iOS (iPhone and iPad) platforms</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1><a class="anchor" name="ios_0">The iOS plugin for developing client applications on iOS (iPhone and iPad) platforms</a></h1><h2><a class="anchor" name="ios_intro">
Introduction</a></h2>
Consuming Web services on iOS (iPhone and iPad) platforms is inreseasingly in demand today. However, Xcode does not have any built-in tools that make consuming Web services easy. It typically requires knowledge of XML processing techniques to send soap requests to the Web services and then parse the returning XML results. The gSOAP toolkit that provides an automated SOAP and XML data binding for C and C++ can be used directly to develop client applications to consuming Web services on iOS platforms such as iPhone and iPad. However, it's default network connection does not leverage the advantages of network connection offered by iOS SDK, instead it uses lower level TCP sockets for network connection. This soap plugin facilitates developers to develop Web services client applications on iOS platforms without maniulating the XML processing. Moreover, it takes andvantages of network connection offered by iOS SDK and supports 3G/4G, wifi etc.<p>
Two Xcode examples, <a class="el" href="ios_0.html#ios_example_calc">A Simple Calculator Example (Pure C)</a> and <a class="el" href="ios_0.html#ios_example_geoip">A GeoIPService (C++)</a> can be found in samples/ios.<h2><a class="anchor" name="ios_1">
Getting Started</a></h2>
To start building Web services client applications for iPhone and/or iPad with gSOAP , you need:<p>
<ul>
<li>The gSOAP package from <a href="http://www.genivia.com/Products/downloads.html">http://www.genivia.com/Products/downloads.html</a> (select gSOAP toolkit standard edition from the list of software packages), and</li>
</ul>
<ul>
<li>Xcode IDE with the iOS SDK installed.</li>
</ul>
Development of Web services applications on iOS is no different from the development SOAP Web services applications on Linux, Unix and Mac OS except with a soap plugin registration. Specifically, there are four steps to develop SOAP Web services client applications on iOS:<p>
<ul>
<li>Generating application stubs using the gSOAP toolkit and add the source files</li>
</ul>
<ul>
<li>Creating an iOS application project to the Xcode project</li>
</ul>
<ul>
<li>Registering the iOS plugin</li>
</ul>
<ul>
<li>Calling service methods</li>
</ul>
<h3><a class="anchor" name="iso_register_pulg">
Registering iOS Plugin (Required)</a></h3>
To register the iOS plugin, simply call <em>soap_register_plugin</em> method:<p>
<div class="fragment"><pre><span class="preprocessor"> #import "<a class="code" href="gsoapios_8h.html">gsoapios.h</a>"</span>
 
 <span class="keyword">struct </span>soap *soap = soap_new();
 soap_register(soap, soap_ios); <span class="comment">// Register the iOS plugin</span>
 ...
 soap_end(soap);  <span class="comment">// Clean up temporaries</span>
 soap_destroy(soap); <span class="comment">// Free soap context</span>
</pre></div><p>
The plugin is destroyed automatically by the soap context when the soap_end method is executed.<h3><a class="anchor" name="ios_cache_policy">
Specifying Cache policy (Optional)</a></h3>
The interaction beween the client and the Web servcie server can be controled by specifying the cache policy. To specify the cache policy, call the method <em><a class="el" href="gsoapios_8m.html#a27">soap_ios_setcachepolicy(struct soap *soap, unsigned int policy)</a> </em>. The method cannot be called before the pluging is registered.<p>
<div class="fragment"><pre><span class="preprocessor"> #import "<a class="code" href="gsoapios_8h.html">gsoapios.h</a>"</span>
 
 <span class="keyword">struct </span>soap *soap = soap_new();
 soap_register(soap, soap_ios); <span class="comment">// Register the iOS plugin</span>
 
 <span class="comment">// Specify the cache policy for the request </span>
 <span class="comment">// Caveat: this method cannot be called before the plugin is registered</span>
 <span class="comment">// If this method is not called, the cache policy is set to NSURLRequestUseProtocolCachePolicy (0) by default.</span>
 soap_ios_setchacepolicy(soap, NSURLRequestReturnCacheDataElseLoad); <span class="comment">// (2)</span>
 <span class="comment">// Or use the integer directly instead of enum</span>
 <span class="comment">// soap_ios_setchacepolicy(soap, 2); // (NSURLRequestReturnCacheDataElseLoad)</span>

 ...
 soap_end(soap);  <span class="comment">// clean up allocated temporaries </span>
 soap_destroy(soap); <span class="comment">// Free soap context</span>
</pre></div><p>
The available cache policies that can be specified are: <div class="fragment"><pre> <span class="keyword">enum</span> {
        NSURLRequestUseProtocolCachePolicy = 0,
        NSURLRequestReloadIgnoringLocalCacheData = 1,
        NSURLRequestReloadIgnoringCacheData = NSURLRequestReloadIgnoringLocalCacheData,
        NSURLRequestReturnCacheDataElseLoad = 2,
        NSURLRequestReturnCacheDataDontLoad = 3,
        NSURLRequestReloadIgnoringLocalAndRemoteCacheData =4,
        NSURLRequestReloadRevalidatingCacheData = 5
 }
</pre></div><p>
If this method is not called, the cache policy is set to NSURLRequestUseProtocolCachePolicy (0) by default.<h3><a class="anchor" name="ios_timeout_interval">
Specifying Timeout Interval (Optional)</a></h3>
The timeout interval for network connection can be specified using the method <em><a class="el" href="gsoapios_8m.html#a28">soap_ios_settimeoutinterval(struct soap *soap, double seconds)</a></em>. The method cannot be called before the pluging is registered. If this method is not called, the timeout interval is 60 seconds by default.<p>
<div class="fragment"><pre><span class="preprocessor"> #import "<a class="code" href="gsoapios_8h.html">gsoapios.h</a>"</span>
 
 <span class="keyword">struct </span>soap *soap = soap_new();
 soap_register(soap, soap_ios); <span class="comment">// Register the iOS plugin</span>
 
 <span class="comment">// Specify the timout interval in terms of seconds </span>
 <span class="comment">// If this method is not called, the timeout interval is set to 60 seconds by default</span>
 <span class="comment">// Caveat: this method cannot be called before the plugin is registered</span>
 <a class="code" href="gsoapios_8h.html#a3">soap_ios_settimeoutinterval</a>(soap, 30.0);
 
 ...
 soap_end(soap);
 soap_destroy(soap);
</pre></div><h3><a class="anchor" name="ios_http_auth">
Handling HTTP Authentication</a></h3>
A server may request user authentication and deny access (HTTP 401 error) when the client tries to connect without HTTP authentication (or with the wrong authentication information).<p>
HTTP authentication (basic) is enabled at the client-side by setting the soap.userid and soap.passwd strings to a username and password, respectively.<p>
Be aware of that both of userid and password must be set in pair, that is, if one of them is set, the other must be set too.<p>
If the server requires basic HTTP authentication, for example, the userid and password can be specified:<p>
<div class="fragment"><pre> <span class="keyword">struct </span>soap *soap = soap_new();
 soap-&gt;userid = <span class="stringliteral">"someone"</span>;
 soap-&gt;passwd = <span class="stringliteral">"somepass"</span>;
 ...
 soap_end(soap); <span class="comment">// Clean up temporaries</span>
 soap_destroy(soap);
</pre></div><h2><a class="anchor" name="ios_example">
Examples</a></h2>
This section intoduces two examples to demonstrate the development of client applications consuming SOAP Web services on iOS platforms (iPhone and iPad) using gSOAP tools and the iOS plugin. Because gSOAP supports development for both pure C and C++, the first example, <a class="el" href="ios_0.html#ios_example_calc">A Simple Calculator Example (Pure C)</a>, is developed using pure C. The second one, <a class="el" href="ios_0.html#ios_example_geoip">A GeoIPService (C++)</a>, is developmed using C++.<p>
We assume you already have had the expereince in development of applications for iPhone and iPad using Xcode with iOS SDK installed.<h3><a class="anchor" name="ios_example_calc">
A Simple Calculator Example (Pure C)</a></h3>
This example shows you how to develop a client application in C using gSOAP and the ios plugin, which consumes a simple caculator service on iOS using gSOAP. The simple calculator service was developed and deployed as a demo using the gSOAP tools (refer to <a href="http://www.genivia.com/Products/gsoap/demos/index.html">http://www.genivia.com/Products/gsoap/demos/index.html</a> for details). The gSOAP Calculator Service provides several operations such as <em>add</em>, <em>sub</em>, <em>mul</em>, <em>div</em> etc. In this example, we use operation <em>add</em> as a demo. Other operations are alled in a similar way. The <em>wsdl</em> file for this service can be obtained at the following link: <a href="http://www.genivia.com/calc.wsdl">http://www.genivia.com/calc.wsdl</a><p>
The Xcode project for this example can be found in samples/ios/calc.<h4><a class="anchor" name="ios_calc_step_1">
Step 1: Generating stubs for C API</a></h4>
To generate codes for the calculator Web service, we first run the <em>wsdl2h</em> tool from the command line on the URL of the WSDL and use option <em>-o</em> to specify the output file (Alternatively, you can download the <em>calc.wsdl</em> and use the local file instead of the URL):<p>
<div class="fragment"><pre> &gt; wsdl2h -c -o calc.h http:<span class="comment">//www.genivia.com/calc.wsdl</span>
</pre></div><p>
This generates the <em>calc.h</em> service definition header file with service operation definitions and types for the operation's data. The option <em>-c</em> flags the <em>wsdl2h</em> tool to generate the service definition file in pure C. By default, gSOAP assumes you will use C++ with STL.<p>
We have not yet generated the stubs for the CAPI. To do so, run the <em>soapcpp2</em> compiler:<p>
<div class="fragment"><pre> &gt; soapcpp2 -i -C calc.h
</pre></div><p>
Option <em>-C</em> indicates client-side only files (<em>soapcpp2</em> generates both client and server stubs and skeletons by default). This generates a number of soource files for client application development.<h4><a class="anchor" name="ios_calc_step_2">
Step 2: Creating Xcode project for iPhone</a></h4>
Launch the Xcode, create a View-based Application project and name it <em>Calc</em>. Open the <em>CalcViewController.xib</em> file in the Interface Builder. Double-click on the View item and populate it with the views listed below and shown in Figure 1:<p>
<ul>
<li>Two Labels ("+" and "A Simple Calculator") </li>
<li>Two Text Fields (operand1 and operand2) </li>
<li>One Round Rect Button ("+" button)</li>
</ul>
<div align="center">
<img src="calc-view.png" alt="calc-view.png">
<p><strong>Figure 1. View of the Calculator Web Service Client</strong></p></div>
 In Xcode, edit the file <em>CalcViewController.h</em> to make it look like the following:<p>
<div class="fragment"><pre> <span class="comment">// File: CalcViewController.h</span>
 
<span class="preprocessor"> #import &lt;UIKit/UIKit.h&gt;</span>
 
 <span class="keyword">@interface </span>CalcViewController : UIViewController {
 UITextField *op1; <span class="comment">// operand1</span>
 UITextField *op2; <span class="comment">// operand2</span>
 
 }
 
 @property (nonatomic, retain) IBOutlet UITextField *op1;
 @property (nonatomic, retain) IBOutlet UITextField *op2;
 
 - (IBAction) buttonPressed;
 @end
</pre></div><p>
Link the op1 and op2 to the two Text Fields and delegate the button action to method buttonPressed.<h4><a class="anchor" name="ios_calc_step_3">
Step 3: Adding generated source stubs to the Xcode project</a></h4>
Add the source files <em>soapC.c</em>, <em>soapClient.c</em>, <em>soapH.h</em>, and <em>soapStub.h</em> generated in <a class="el" href="ios_0.html#ios_calc_step_1">Step 1: Generating stubs for C API</a> to the project. Also add files <em>stdsoap2.h</em> and <em>stdsoap2.c</em> to the project from gsoap package as well as the iOS pluhin files <em><a class="el" href="gsoapios_8h.html">gsoapios.h</a></em> and <em>sgsoapios.m</em>.<h4><a class="anchor" name="ios_calc_step_4">
Step 4: Implementing the Logic by calling the soap service</a></h4>
Firstly, edit file <em>main.m</em> to import the file <em>./Classes/calc.nsmap</em>. Link errors may arise without importing this namespace mapping.<p>
<div class="fragment"><pre> <span class="comment">// File: main.m</span>
 
<span class="preprocessor"> #import &lt;UIKit/UIKit.h&gt;</span>
<span class="preprocessor"> #import "./Classes/calc.nsmap"</span>
 
 <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {
 
   NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];
   <span class="keywordtype">int</span> retVal = UIApplicationMain(argc, argv, nil, nil);
   [pool release];
 
   <span class="keywordflow">return</span> retVal;
 }
</pre></div><p>
Then, implememt the source file <em>CalcViewController.m</em> as the following:<p>
<div class="fragment"><pre><span class="preprocessor"> #import "CalcViewController.h"</span>
<span class="preprocessor"> #import "soapStub.h"</span>
<span class="preprocessor"> #import "<a class="code" href="gsoapios_8h.html">gsoapios.h</a>"</span>
 
 <span class="keyword">@implementation </span>CalcViewController
 
 @synthesize op1; <span class="comment">// Set or get opreand1</span>
 @synthesize op2; <span class="comment">// Set or get opreand1</span>
 
 - (IBAction) buttonPressed {
 
 <span class="keywordtype">double</span> x = [op1.text doubleValue];
 <span class="keywordtype">double</span> y = [op2.text doubleValue];
 
 <span class="keyword">struct </span>soap *soap = soap_new();
 
 <span class="keywordflow">if</span> (soap_register_plugin(soap, soap_ios) == SOAP_OK) {
   
 <span class="comment">// Specify the cache policy (optional) to NSURLRequestReturnCacheDataElseLoad</span>
   <span class="comment">// instead of NSURLRequestUseProtocolCachePolicy by deault</span>
   <a class="code" href="gsoapios_8h.html#a2">soap_ios_setcachepolicy</a>(soap, NSURLRequestReturnCacheDataElseLoad);
 
   <span class="comment">// Specify the timeout interval (optional) to 45 seconds instead of</span>
   <span class="comment">// the default 60 seconds</span>
   <a class="code" href="gsoapios_8h.html#a3">soap_ios_settimeoutinterval</a>(soap, 45.0);
 
   <span class="keywordtype">double</span> result;
 
   <span class="comment">// Call Web service operation add</span>
   <span class="keywordtype">int</span> status = soap_call_ns2__add(soap, NULL, NULL, x, y, &amp;result);
 
   soap_free_temp(soap); <span class="comment">// Cleanup temporary resources</span>
 
   <span class="comment">// Check soap response status</span>
   <span class="keywordflow">if</span> (status == SOAP_OK) {
     
     NSString *resultString;
     NSString *tittleString;
 
     <span class="keywordflow">if</span> (status == SOAP_OK) {
       resultString = [NSString stringWithFormat:@"%f",result];
       tittleString = [NSString stringWithFormat:@"%f / %f =",x, y];
     }<span class="keywordflow">else</span> {
       resultString = [NSString stringWithFormat:@"%@",@"Soap fault!"];
       tittleString = [NSString stringWithFormat:@"%@",@"Warning"];
     }
 
 
     <span class="comment">// Show the result in an alert</span>
     UIAlertView *alert = [[UIAlertView alloc] initWithTitle:tittleString
                                               message:resultString     
                                               delegate:self
                                               cancelButtonTitle:@"OK"
                                                                                                                                                                                         otherButtonTitles:nil];
 
     [alert show]; <span class="comment">// Show the alert</span>
     [alert release]; <span class="comment">// Release the alert</span>
 
     } <span class="keywordflow">else</span> {
       <span class="comment">// Caveat: Better to extract the error message and show it using an alert</span>
       soap_print_fault(soap,stderr); <span class="comment">// Print soap error in console</span>
     }
   }
 
   soap_end(soap); <span class="comment">// clean up allocated temporaries </span>
   soap_free(soap); <span class="comment">// Free soap context</span>
  }
 
 ... 
</pre></div><p>
A screen snapshot of the client is shown in Figure 2.<p>
<div align="center">
<img src="calc-result.png" alt="calc-result.png">
<p><strong>Figure 2: Snapshot of the CalcViewService result</strong></p></div>
<h3><a class="anchor" name="ios_example_geoip">
A GeoIPService (C++)</a></h3>
GeoIPService is a live SOAP Web service that enables you to look up contries by IP address or by Context.<p>
This example shows you how to develop a client application in C++ using gSOAP and the ios plugin, which consumes the GeoIPSerive on iOS using gSOAP. The WSDL file for this servive can be downloaded at the following link: <a href="http://www.webservicex.net/geoipservice.asmx?WSDL">http://www.webservicex.net/geoipservice.asmx?WSDL</a><p>
Devoplopment of he client appliation for this GeoIPService on iOS is similar to development for the cleant appliaction for <a class="el" href="ios_0.html#ios_example_calc">A Simple Calculator Example (Pure C)</a>. The major dfferences are highlighted in following:<p>
<ul>
<li>Rename the <em>.m</em> files to <em>.mm</em> files. The iOS plugin implementation file <em><a class="el" href="gsoapios_8m.html">gsoapios.m</a></em> must be renamed to <em>gsoapios.mm</em>. The <em>main.m</em> must be renamed to <em>main.mm</em>. Other files such as your ViewController may also be renamed with <em>.mm</em>.</li>
</ul>
<ul>
<li>Generate C++ proxy using proper options with <em>wsdl2h</em> and <em>soapcpp2</em></li>
</ul>
<ul>
<li>Use the <em>stdsoap2.cpp</em> instead of <em>stdsoap2.c</em> from the gSOAP package in your iOS project.</li>
</ul>
The Xcode project for this example can be found in samples/ios/GeoIPService.<h4><a class="anchor" name="ios_geoip_step_1">
Step 1: Generating stubs for C++ Proxy</a></h4>
To generate codes for the GeoIPSerbice Web service, we first run the <em>wsdl2h</em> tool from the command line on the URL of the WSDL and use option <em>-o</em> to specify the output file (Alternatively, you can download the <em>GeoIPService.wsdl</em> file and use the local file instead of the URL):<p>
<div class="fragment"><pre> &gt;wsdl2h -o GeoIPService.h http:<span class="comment">//www.webservicex.net/geoipservice.asmx?WSDL</span>
</pre></div><p>
This generates the <em>GeoIPService.h</em> service definition header file with service operation definitions and types for the operation's data. By default, gSOAP assumes you will use C++ with STL.<p>
To generate the stubs for the C++ proxy classes, run the <em>soapcpp2</em> compiler:<p>
<div class="fragment"><pre>  &gt;soapcpp2 -i -C -I$GSOAP_HOME/import GeoIPService.h
</pre></div><p>
Option <em>-i</em> tells the compiler to generate C++ proxy and option <em>-C</em> indicates client-side only files (<em>soapcpp2</em> generates both client and server stubs and skeletons by default). Option -I is needed to import the <em>stlvector.h</em> file from the import directory in the gSOAP package to support serialization of STL vectors.<h4><a class="anchor" name="ios_geoip_step_2">
Step 2: Creating Xcode project for iPhone</a></h4>
Create a View-based Application project and name it <em>GeoIPService</em> and rename the <em>.m</em> source files to <em>.mm</em>. Open the <em>GeoIPserviceViewController.xib</em> file in the Interface Builder. Double-click on the View item and populate it with the views listed below and shown in Figure 3:<p>
<ul>
<li>A Label ("IP Address") </li>
<li>A Text Field </li>
<li>One Round Rect Button ("Find Country" button)</li>
</ul>
<div align="center">
<img src="geoip-view.png" alt="geoip-view.png">
<p><strong>Figure 3. View of the GeoIPService Client</strong></p></div>
 In Xcode, edit the file <em>GeoIPServiceViewController.h</em> to make it look like the following:<p>
<div class="fragment"><pre> <span class="comment">// File: GeoIPServiceViewController.h</span>
 
<span class="preprocessor"> #import &lt;UIKit/UIKit.h&gt;</span>
  <span class="keyword">@interface </span>GeoIPServiceViewController : UIViewController {
 
    UITextField *ipAddress;
 
 }
  
 @property (nonatomic, retain) IBOutlet UITextField *ipAddress;
 
 - (IBAction) buttonFindCountry:(<span class="keywordtype">id</span>)sender; 
 
 @end
</pre></div><p>
Set the ipAddress outlet and the buttonFindCountry:(id)sender method to delegate action of the button.<h4><a class="anchor" name="ios_geoip_step_3">
Step 3: Adding generated source stubs to the Xcode project</a></h4>
Add the source files <em>soapC.cpp</em>, <em>GeoIPServiceSoap12Proxy.cpp</em>, <em>GeoIPServiceSoap12Proxy.h</em>, <em>soapH.h</em>, and<em>soapStub.h</em> generated in <a class="el" href="ios_0.html#ios_geoip_step_1">Step 1: Generating stubs for C++ Proxy</a> to the project. Also add files<em>stdsoap2.h</em> and <em>stdsoap2.cpp</em> to the project from gsoap package and the iOS pluhin files <em><a class="el" href="gsoapios_8h.html">gsoapios.h</a></em> and <em>sgsoapios.m</em>. Do not forget to rename the <em>sgsoapios.m</em> to <em>sgsoapios.mm</em><p>
The <em>GeoIPServiceSoap12Proxy.h</em> and <em>GeoIPServiceSoap12Proxy.cpp</em> are C++ proxy header and implementation files for SOAP 1.2 (You may use <em>GeoIPServiceSoapProxy.cpp</em> and <em>GeoIPServiceSoapProxy.h</em> for SOAP1.1).<h4><a class="anchor" name="ios_geoip_step_4">
Step 4: Implementing the Logic by calling the soap service</a></h4>
Firstly, edit file <em>main.mm</em> to import the file <em>./Classes/GeoIPService.nsmap</em>. Link errors would arise without importing this namespace mapping.<p>
<div class="fragment"><pre> <span class="comment">// File: main.mm</span>
 
<span class="preprocessor"> #import &lt;UIKit/UIKit.h&gt;</span>
<span class="preprocessor"> #import "./Classes/GeoIPServiceSoap12.nsmap"</span>
 
 <span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[]) {
 
   NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];
   <span class="keywordtype">int</span> retVal = UIApplicationMain(argc, argv, nil, nil);
   [pool release];
   <span class="keywordflow">return</span> retVal;
 }
</pre></div><p>
Then, implememt the source file <em>GeoIPServiceViewController.m</em> as the following:<p>
<div class="fragment"><pre><span class="preprocessor"> #import "GeoIPServiceViewController.h"</span>
<span class="preprocessor"> #include "soapGeoIPServiceSoap12Proxy.h"</span>
<span class="preprocessor"> #import "<a class="code" href="gsoapios_8h.html">gsoapios.h</a>"</span>
 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
 
 <span class="keyword">typedef</span> <span class="keyword">struct </span>_ns1__GetGeoIP RequestStruct;
 <span class="keyword">typedef</span> <span class="keyword">struct </span>_ns1__GetGeoIPResponse ResponseStruct;
 
 
 <span class="keyword">@implementation </span>GeoIPServiceViewController
 
 @synthesize ipAddress;
 
 - (IBAction)buttonFindCountry:(<span class="keywordtype">id</span>)sender {
 
   RequestStruct ip;
   ResponseStruct response;
   GeoIPServiceSoap12Proxy service;
 
   std::string ipAdd = std::string((<span class="keywordtype">char</span> *)[ipAddress.text UTF8String]);
   ip.IPAddress = &amp;ipAdd;
 
 
   <span class="comment">// ----- register plugin for callbacks ------</span>
   soap_register_plugin(&amp;service, soap_ios);
 
   <span class="comment">// Optional: timeout internal, the default is 60.0 seconds</span>
   <a class="code" href="gsoapios_8h.html#a3">soap_ios_settimeoutinterval</a>(&amp;service, 30.0);
 
   <span class="comment">// Optional: the default policy is NSURLRequestUseProtocolCachePolicy (0)</span>
   <a class="code" href="gsoapios_8h.html#a2">soap_ios_setcachepolicy</a>(&amp;service, NSURLRequestReturnCacheDataElseLoad); <span class="comment">// (2)</span>
 
   <span class="keywordtype">int</span> status = service.GetGeoIP(&amp;ip, &amp;response);
 
   string* result;
   string err_msg = <span class="stringliteral">"Invalid IP address"</span>;
 
   <span class="keywordflow">if</span> ( status == SOAP_OK) {            
     <span class="keywordflow">if</span>(response.GetGeoIPResult &amp;&amp; response.GetGeoIPResult-&gt;CountryName) {
       result = response.GetGeoIPResult-&gt;CountryName;
     } <span class="keywordflow">else</span> {
       result = &amp;err_msg;
     }
   } <span class="keywordflow">else</span> {
     service.soap_stream_fault(std::cerr); 
   }
 
 
   NSString *soapResult;
   NSString *tittleMsg;
 
   <span class="keywordflow">if</span> (status == SOAP_OK) {
     soapResult = [NSString stringWithUTF8String:result-&gt;c_str()];
     tittleMsg = [NSString stringWithFormat: @"%@", @"Country Found"];
   } <span class="keywordflow">else</span> {
     soapResult = [NSString stringWithFormat: @"%@", @"Soap Error!"];
     tittleMsg = [NSString stringWithFormat: @"%@", @"Warning"];
   }
 
   UIAlertView *alert = [[UIAlertView alloc] initWithTitle:tittleMsg      
                                 message:soapResult
                                                                                                                                delegate:self
                       cancelButtonTitle:@"OK"
                       otherButtonTitles:nil];
 
   [alert show];
   [alert release];
 
   service.destroy(); <span class="comment">// Free soap context</span>
 }
 
 ... 
</pre></div><p>
A screen snapshot of the client is shown in Figure 4.<p>
<div align="center">
<img src="geoip-result.png" alt="geoip-result.png">
<p><strong>Figure : Snapshot of the GeoIPServiceViewService result</strong></p></div>
<hr size="1"><address style="align: right;"><small>Generated on Sat Jun 9 03:26:17 2012 for gSOAP iOS by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
